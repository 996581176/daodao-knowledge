---
title: 整体架构篇
date: 2023-03-25 12:32:54
permalink: /pages/31fc53/
categories:
  - react
  - react+antd+react-router+redux后台管理系统
tags:
    -
---
## 定义路由 
  ### 安装
  现在界面光秃秃的不好看，而且只有一页，我们先安装一下react router，老规矩，这是[react router的文档](https://reactrouter.com/en/main),一定要多看文档，一定要多看文档，一定要多看文档，重要的事情说三遍。
  ```
  npm install react-router-dom -S
  ```
 ### 定义路由 
   react router有两种路由，一种是`HashRouter`，另一种是`BrowserRouter`,其中`HashRouter`并不需要服务端做配置，而是路由中带一个`#`键，由前端来转发，所以我们选用`HashRouter`

   - 在App.tsx中引入HashRouter,并让HashRouter包裹在最外层
```tsx {2,6,8}
// app.tsx
import { HashRouter } from "react-router-dom"

const App = () => {
  return (
    <HashRouter>
      App
    </HashRouter>
  )
}

export default App
```
  - 新建views文件夹，定义login.tsx和home.tsx两个页面  
  ![](https://gitee.com/knif/img/raw/master/20230327160000.png)

  - 新建routers文件夹，里面定义路由相关的东西，首先创建 index.tsx，我们使用`useRoute`钩子
  ```tsx
  import {useRoutes} from "react-router-dom"

  import Login from "@/views/login/index"
  import Home from "@/views/home/index"

  export const rootRouter = [
      {
          path:"/",
          element: <Home></Home>
      },
      {
          path:'/login',
          element: <Login></Login>
      }
  ]

  const Router = () => {
      const routes = useRoutes(rootRouter)

      return routes
  }

  export default Router
  ```

  - 在App.tsx中引入Router
  ```tsx {2,7}
  import { HashRouter } from "react-router-dom"
  import Router from "@/routers/index"

  const App = () => {
    return (
      <HashRouter>
        <Router />
      </HashRouter>
    )
  }

  export default App
  ```
  访问地址`http://localhost:5000/`，页面渲染出刚刚定义的home.tsx的内容  
  访问地址`http://localhost:5000/#/login`,页面渲染出刚刚定义的login.tsx的内容

## 安装antd
因为后面会用到antd中的一些组件，所以安装antd,[antd官网](https://ant.design/docs/react/practical-projects-cn)
```
npm install antd -S
```
然后在main.tsx中引入样式文件
```tsx
import "antd/dist/reset.css"
```
后面需要使用antd组件的时候再按需加载即可

 ### 路由懒加载
 随着页面越来越多，一次性加载所有页面资源非常的占用时间，有没有一种办法，可以只加载当然要访问的那个页面呢？

 在react官方文档上其实给出了解决方案，[React.Lazy](https://zh-hans.reactjs.org/reference/react/lazy)  
 ![](https://gitee.com/knif/img/raw/master/20230327174857.png)
 但是懒加载会花上一段时间，在这段时间内会有白屏的现象，可以将懒加载的组件用`Suspense`标签包裹起来，`Suspense`的`fallback`属性是组件没有加载出来时显示的内容。

- 在routers下新建 utils/lazyLoad.tsx
- lazyLoad接收React.lazy()加载的组件,加载过程中显示antd的Spin组件
```tsx
import React, { Suspense } from 'react';
import { Spin } from 'antd';

/**
 * @description 路由懒加载
 * @param 需要访问的组件
 * @returns 
 */
const lazyLoad = (Comp:React.LazyExoticComponent<() => JSX.Element>) => { 
  return (
    <>
      <Suspense fallback={
        <Spin
            size="large"
            style={{
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                height: "100%"
            }}
        />
      }>
        <Comp />
      </Suspense>
    </>
  );
}

export default lazyLoad
```
- 在router/index.tsx中将路由中加载的组件改写为懒加载方式
```tsx {2,3,8,12}
import {useRoutes} from "react-router-dom"
import lazyLoad from "./utils/lazyLoad"
import React from "react"

export const rootRouter = [
    {
        path:"/",
        element: lazyLoad(React.lazy(() => import("@/views/home")))
    },
    {
        path:'/login',
        element: lazyLoad(React.lazy(() => import("@/views/login")))
    }
]

const Router = () => {
    const routes = useRoutes(rootRouter)

    return routes
}

export default Router
```
切换页面地址，可以看到对应组件被加载了  
![](https://gitee.com/knif/img/raw/master/20230327195227.png)
## 登录界面
登录界面比较简陋，简单用antd的Form组件写个登录界面
```tsx
  // login.tsx
  import LoginForm from "./components/loginForm"
  import logo from "@/assets/images/react.svg"
  import "./index.less"

  const Login = () => {
      return (
          <div className="login-container">
              <div className="login-box">
                  <div className="login-form">
                      <div className="login-logo">
                          <img className="login-icon" src={logo} alt="logo" />
                          <span className="logo-text">My-React-Admin</span>
                      </div>
                      <LoginForm />
                  </div>
              </div>
          </div>
      )
  }

  export default Login
```

定义一下登录界面的ts类型, 登录界面表单一共有两个字段，username和passord,它们都是string类型：
```ts
// types/login.ts
//  * 登录
export namespace Login {
    export interface ReqLoginForm {
        username: string;
        password: string;
    }
}
```

```tsx
  // login/components/loginForm.tsx
  import {Button, Form, Input} from "antd"
  import { UserOutlined, LockOutlined, CloseCircleOutlined } from "@ant-design/icons";
  import { useState } from "react";
  import { Login } from "@/types/login";

  const LoginForm = () => {
      const [loading, setLoading] = useState<boolean>(false)
      const [form] = Form.useForm()

      //login
      const onFinish = async (loginForm: Login.ReqLoginForm) => {
          console.log(loginForm)
      }

      const onFinishFailed = (errorInfo: any) => {
          console.log("Failed", errorInfo)
      }

      return (
          <Form
              form={form}
              name="basic"
              labelCol={{span:5}}
              initialValues={{remenber: true}}
              size="large"
              onFinish={onFinish}
        onFinishFailed={onFinishFailed}
              autoComplete="off"
          >
              <Form.Item name="username" rules={[{required:true, message:"请输入用户名"}]}>
                  <Input placeholder="用户名：admin/user" prefix={<UserOutlined />}/>
              </Form.Item>
              <Form.Item name="password" rules={[{required:true, message:'请输入密码'}]}>
                  <Input.Password autoComplete="new-password" placeholder="密码：123456" prefix={<LockOutlined />}/>
              </Form.Item>
              <Form.Item className="login-btn">
                  <Button
                      onClick={() => {
                          form.resetFields()
                      }}
                      icon={<CloseCircleOutlined />}
                  >
                      重置
                  </Button>
                  <Button type="primary" loading={loading} htmlType="submit" icon={<UserOutlined />}>登录</Button>
              </Form.Item>
          </Form>
      )
  }

  export default LoginForm
```
登录界面现在的样子如下：  
![](https://gitee.com/knif/img/raw/master/20230327215354.png)
输入用户名和密码点击登录，控制台会打印出刚刚的输入：  
![](https://gitee.com/knif/img/raw/master/20230327215609.png)

## 使用easy mock模拟登录接口
## 封装axios
## 使用redux
 ### store设计
 ### redux-toolkit
 ### redux-persist持久化
## 导航守卫 
## 封装全局Loading
## Layout 
  ### Layout布局
  ### 关于二级路由以及Outlet
  ### 侧边栏
   #### 展开收起侧边栏
   #### 如何判断当前高亮菜单
  ### header
   #### 面包屑导航
   #### 个人信息窗口弹出，以及如何暴露方法给父组件
   #### 退出登录
  ### tabs
  ### footer
## 随便创建几个新页面试一试
