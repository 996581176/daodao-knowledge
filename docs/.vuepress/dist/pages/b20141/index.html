<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PySpark综合案例 | 刀刀的知识积累</title>
    <meta name="generator" content="VuePress 1.8.2">
    <script>var _hmt = _hmt || [];
            (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?6371333d39195dbe958ef14c0a722ac4";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
            })();</script>
    <link rel="icon" href="/daodao-knowledge/img/newlogo.ico">
    <meta name="description" content="立志不再懒懒散散的小前端的知识库">
    <meta name="referrer" content="no-referrer">
    
    <link rel="preload" href="/daodao-knowledge/assets/css/0.styles.4ed6a1f2.css" as="style"><link rel="preload" href="/daodao-knowledge/assets/js/app.f5ed6583.js" as="script"><link rel="preload" href="/daodao-knowledge/assets/js/8.65e0c7d8.js" as="script"><link rel="preload" href="/daodao-knowledge/assets/js/9.2d64f842.js" as="script"><link rel="preload" href="/daodao-knowledge/assets/js/75.3f2ed8e5.js" as="script"><link rel="prefetch" href="/daodao-knowledge/assets/js/1.ec9e032c.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/10.720ca8be.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/100.70819400.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/101.b75d5572.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/102.9aca055f.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/103.83b7b56e.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/104.7a7cc98f.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/105.49aa9b94.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/106.23d81b78.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/107.c9c2c7f6.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/108.9454ebec.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/109.b38c98a0.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/11.f6715383.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/110.9124e61b.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/111.d14c0cc4.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/112.6764db6f.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/113.32158181.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/114.eee97224.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/115.92506871.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/116.a70520dc.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/117.cc6a74c0.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/118.49ee1e9e.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/119.8ec79063.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/12.559a8934.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/120.01f4b32e.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/121.a7bf02fd.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/122.d8384da6.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/123.d589aa55.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/124.6347993a.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/125.e60007b8.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/126.3c2f2496.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/127.d2e74aaf.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/128.630ac82c.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/129.e88e4235.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/13.b5ffe300.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/130.8074cb37.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/131.651fb60d.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/132.6a81306b.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/133.18194245.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/134.4a32b80e.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/135.d831da00.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/136.f89103c0.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/137.c216148a.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/138.f306ff64.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/139.0c804f39.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/14.fb66ad81.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/140.ac4036d7.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/141.65841381.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/142.f5392cb3.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/143.d22c4e3f.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/144.a0ba410a.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/145.6d085275.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/146.db87b628.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/147.6f01e81f.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/148.db2ea310.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/149.eecce60c.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/15.0b15a4d5.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/150.b45665b4.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/151.74872e28.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/152.35780d9b.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/153.e3bc7ada.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/154.64ffbbe3.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/155.8d399bd9.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/156.391cc0e9.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/157.68687c0f.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/158.a8dd3fc3.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/159.ed53e1f8.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/16.ad8b60c3.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/160.f99a68ae.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/161.8962233f.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/162.14da1e3d.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/163.28c767de.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/164.2a7494dc.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/165.6464c5dc.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/166.492eca31.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/167.edf45838.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/168.e2cb3bf8.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/169.676fbad0.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/17.8fa02d1f.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/170.d7e67fe2.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/171.c609c882.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/172.e41f5c04.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/173.ccf77eb2.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/174.56f71155.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/175.f45d785e.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/176.8d89d059.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/18.babb446b.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/19.492f64aa.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/2.0df6c674.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/20.4d9f0971.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/21.d6998cd8.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/22.79b4e95c.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/23.bf56fc59.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/24.05f7725b.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/25.679e79b4.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/26.bdbda63c.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/27.e177f8d5.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/28.9c656ef0.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/29.dc0e6823.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/3.10597bdb.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/30.1772baff.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/31.2419595e.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/32.5d921a82.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/33.23aa45e0.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/34.69515070.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/35.dc21d06d.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/36.80b7a1e5.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/37.dae035cc.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/38.9780909a.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/39.7f22b327.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/4.8d4e1f1b.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/40.cb9c6e4e.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/41.c7afa2e8.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/42.ad32dc33.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/43.e4f37979.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/44.46923c01.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/45.4c8ff4df.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/46.6c648ccc.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/47.02968b8c.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/48.50fb8cf2.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/49.de20685e.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/5.2b70d0c7.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/50.d81f6a4c.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/51.9b9764a0.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/52.756c48d3.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/53.b3cfffe1.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/54.ca8096a3.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/55.c2300bde.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/56.544a14a2.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/57.ab2a6cc4.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/58.e66a191d.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/59.c3b2330a.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/6.d57d4555.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/60.9a06f5d9.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/61.069fc274.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/62.cced5817.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/63.4a909e52.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/64.42057196.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/65.d105f840.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/66.62eb2d17.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/67.abb02440.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/68.5eee0026.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/69.76acf6b4.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/70.777642b8.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/71.506df5ec.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/72.03d63db6.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/73.369ae011.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/74.050229d1.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/76.1a60a183.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/77.0290981c.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/78.698d2cd6.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/79.19d354fc.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/80.689507a6.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/81.f715c724.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/82.aa5226c4.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/83.cef9779e.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/84.ec61b86b.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/85.a33f8279.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/86.410654a9.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/87.9f3b93de.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/88.1acc10f3.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/89.3f936ffe.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/90.919e56fa.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/91.7816c6ac.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/92.f0e94e26.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/93.f1f46b34.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/94.5fe0e57a.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/95.ad99255c.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/96.43ec3e6e.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/97.85c85121.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/98.994c6c86.js"><link rel="prefetch" href="/daodao-knowledge/assets/js/99.e6f85e55.js">
    <link rel="stylesheet" href="/daodao-knowledge/assets/css/0.styles.4ed6a1f2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/daodao-knowledge/" class="home-link router-link-active"><img src="/daodao-knowledge/img/home.jpg" alt="刀刀的知识积累" class="logo"> <span class="site-name can-hide">刀刀的知识积累</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/daodao-knowledge/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端学习" class="dropdown-title"><span class="title">前端学习</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端学习" class="mobile-dropdown-title"><span class="title">前端学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/daodao-knowledge/pages/600fd9/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/daodao-knowledge/pages/12e2d5/" class="nav-link">
  算法&amp;常用方法
</a></li><li class="dropdown-subitem"><a href="/daodao-knowledge/pages/450a09/" class="nav-link">
  TypeScript
</a></li><li class="dropdown-subitem"><a href="/daodao-knowledge/pages/ffc1d9/" class="nav-link">
  css
</a></li><li class="dropdown-subitem"><a href="/daodao-knowledge/pages/a5dbfb/" class="nav-link">
  现代JavaScript库开发
</a></li></ul></li><li class="dropdown-item"><h4>
          框架学习
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/daodao-knowledge/pages/8ea889/" class="nav-link">
  react
</a></li><li class="dropdown-subitem"><a href="/daodao-knowledge/pages/3ba846/" class="nav-link">
  vuePress
</a></li><li class="dropdown-subitem"><a href="/daodao-knowledge/pages/347ae3/" class="nav-link">
  qiankun微前端
</a></li><li class="dropdown-subitem"><a href="/daodao-knowledge/pages/f97ef5/" class="nav-link">
  vue3
</a></li></ul></li><li class="dropdown-item"><h4>
          webgl学习
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/daodao-knowledge/pages/7fb7ad/" class="nav-link">
  threejs
</a></li><li class="dropdown-subitem"><a href="/daodao-knowledge/pages/e77551/" class="nav-link">
  the book of shaders
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端学习" class="dropdown-title"><span class="title">后端学习</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端学习" class="mobile-dropdown-title"><span class="title">后端学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/daodao-knowledge/pages/437984/" class="nav-link">
  python
</a></li></ul></div></div><div class="nav-item"><a href="/daodao-knowledge/pages/cd2a4f/" class="nav-link">
  零零碎碎
</a></div><div class="nav-item"><a href="/daodao-knowledge/pages/9d1205/" class="nav-link">
  随记
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><span class="title">索引</span> <span class="arrow down"></span></button> <button type="button" aria-label="索引" class="mobile-dropdown-title"><span class="title">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/daodao-knowledge/archives/" class="nav-link">
  归档
</a></li></ul></div></div><div class="nav-item"><a href="/daodao-knowledge/daodao/" class="nav-link">
  关于我
</a></div> <a href="https://github.com/Ostask/daodao-knowledge" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/daodao-knowledge/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端学习" class="dropdown-title"><span class="title">前端学习</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端学习" class="mobile-dropdown-title"><span class="title">前端学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/daodao-knowledge/pages/600fd9/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/daodao-knowledge/pages/12e2d5/" class="nav-link">
  算法&amp;常用方法
</a></li><li class="dropdown-subitem"><a href="/daodao-knowledge/pages/450a09/" class="nav-link">
  TypeScript
</a></li><li class="dropdown-subitem"><a href="/daodao-knowledge/pages/ffc1d9/" class="nav-link">
  css
</a></li><li class="dropdown-subitem"><a href="/daodao-knowledge/pages/a5dbfb/" class="nav-link">
  现代JavaScript库开发
</a></li></ul></li><li class="dropdown-item"><h4>
          框架学习
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/daodao-knowledge/pages/8ea889/" class="nav-link">
  react
</a></li><li class="dropdown-subitem"><a href="/daodao-knowledge/pages/3ba846/" class="nav-link">
  vuePress
</a></li><li class="dropdown-subitem"><a href="/daodao-knowledge/pages/347ae3/" class="nav-link">
  qiankun微前端
</a></li><li class="dropdown-subitem"><a href="/daodao-knowledge/pages/f97ef5/" class="nav-link">
  vue3
</a></li></ul></li><li class="dropdown-item"><h4>
          webgl学习
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/daodao-knowledge/pages/7fb7ad/" class="nav-link">
  threejs
</a></li><li class="dropdown-subitem"><a href="/daodao-knowledge/pages/e77551/" class="nav-link">
  the book of shaders
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端学习" class="dropdown-title"><span class="title">后端学习</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端学习" class="mobile-dropdown-title"><span class="title">后端学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/daodao-knowledge/pages/437984/" class="nav-link">
  python
</a></li></ul></div></div><div class="nav-item"><a href="/daodao-knowledge/pages/cd2a4f/" class="nav-link">
  零零碎碎
</a></div><div class="nav-item"><a href="/daodao-knowledge/pages/9d1205/" class="nav-link">
  随记
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><span class="title">索引</span> <span class="arrow down"></span></button> <button type="button" aria-label="索引" class="mobile-dropdown-title"><span class="title">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/daodao-knowledge/archives/" class="nav-link">
  归档
</a></li></ul></div></div><div class="nav-item"><a href="/daodao-knowledge/daodao/" class="nav-link">
  关于我
</a></div> <a href="https://github.com/Ostask/daodao-knowledge" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>python基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/daodao-knowledge/pages/8cd0c7/" class="sidebar-link">基础语法</a></li><li><a href="/daodao-knowledge/pages/437984/" class="sidebar-link">判断语句</a></li><li><a href="/daodao-knowledge/pages/f6b491/" class="sidebar-link">循环语句</a></li><li><a href="/daodao-knowledge/pages/c81e27/" class="sidebar-link">函数</a></li><li><a href="/daodao-knowledge/pages/42087e/" class="sidebar-link">数据容器</a></li><li><a href="/daodao-knowledge/pages/4edcaf/" class="sidebar-link">函数进阶</a></li><li><a href="/daodao-knowledge/pages/4c6894/" class="sidebar-link">文件操作</a></li><li><a href="/daodao-knowledge/pages/63f8e1/" class="sidebar-link">异常、模块与包</a></li><li><a href="/daodao-knowledge/pages/9f167b/" class="sidebar-link">面向对象</a></li><li><a href="/daodao-knowledge/pages/1f7757/" class="sidebar-link">SQL入门和实战</a></li><li><a href="/daodao-knowledge/pages/b20141/" aria-current="page" class="active sidebar-link">PySpark综合案例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daodao-knowledge/pages/b20141/#spark是什么" class="sidebar-link">Spark是什么</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daodao-knowledge/pages/b20141/#pyspark" class="sidebar-link">PySpark</a></li></ul></li><li class="sidebar-sub-header"><a href="/daodao-knowledge/pages/b20141/#基础准备" class="sidebar-link">基础准备</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daodao-knowledge/pages/b20141/#pyspark库的安装" class="sidebar-link">PySpark库的安装</a></li><li class="sidebar-sub-header"><a href="/daodao-knowledge/pages/b20141/#构建pyspark执行环境入口对象" class="sidebar-link">构建PySpark执行环境入口对象</a></li><li class="sidebar-sub-header"><a href="/daodao-knowledge/pages/b20141/#pyspark的编程模型" class="sidebar-link">PySpark的编程模型</a></li></ul></li><li class="sidebar-sub-header"><a href="/daodao-knowledge/pages/b20141/#数据输入" class="sidebar-link">数据输入</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daodao-knowledge/pages/b20141/#rdd对象" class="sidebar-link">RDD对象</a></li><li class="sidebar-sub-header"><a href="/daodao-knowledge/pages/b20141/#python数据容器转rdd对象" class="sidebar-link">Python数据容器转RDD对象</a></li><li class="sidebar-sub-header"><a href="/daodao-knowledge/pages/b20141/#读取文件转rdd对象" class="sidebar-link">读取文件转RDD对象</a></li></ul></li><li class="sidebar-sub-header"><a href="/daodao-knowledge/pages/b20141/#数据计算" class="sidebar-link">数据计算</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daodao-knowledge/pages/b20141/#map方法" class="sidebar-link">map方法</a></li><li class="sidebar-sub-header"><a href="/daodao-knowledge/pages/b20141/#flatmap算子" class="sidebar-link">flatMap算子</a></li><li class="sidebar-sub-header"><a href="/daodao-knowledge/pages/b20141/#reducebykey算子" class="sidebar-link">reduceByKey算子</a></li><li class="sidebar-sub-header"><a href="/daodao-knowledge/pages/b20141/#filter" class="sidebar-link">Filter</a></li><li class="sidebar-sub-header"><a href="/daodao-knowledge/pages/b20141/#distinct算子" class="sidebar-link">distinct算子</a></li><li class="sidebar-sub-header"><a href="/daodao-knowledge/pages/b20141/#sortby算子" class="sidebar-link">sortBy算子</a></li></ul></li><li class="sidebar-sub-header"><a href="/daodao-knowledge/pages/b20141/#数据输出" class="sidebar-link">数据输出</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/daodao-knowledge/pages/b20141/#collect算子" class="sidebar-link">collect算子</a></li><li class="sidebar-sub-header"><a href="/daodao-knowledge/pages/b20141/#reduce算子" class="sidebar-link">reduce算子</a></li><li class="sidebar-sub-header"><a href="/daodao-knowledge/pages/b20141/#take算子" class="sidebar-link">take算子</a></li><li class="sidebar-sub-header"><a href="/daodao-knowledge/pages/b20141/#count算子" class="sidebar-link">count算子</a></li><li class="sidebar-sub-header"><a href="/daodao-knowledge/pages/b20141/#saveastextfile算子" class="sidebar-link">saveAsTextFile算子</a></li><li class="sidebar-sub-header"><a href="/daodao-knowledge/pages/b20141/#修改rdd分区为1个" class="sidebar-link">修改rdd分区为1个</a></li></ul></li></ul></li><li><a href="/daodao-knowledge/pages/44ca69/" class="sidebar-link">Python高阶技巧</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Python基础综合案例</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python进阶</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="page-content hasRightNav"><div class="right-nav" data-v-e3ddc674></div> <div class="article-title theme-default-content" data-v-fda27140><h1 data-v-fda27140><span class="circle" data-v-fda27140></span>PySpark综合案例</h1> <div class="lastUpdatedTime" data-v-fda27140><span class="text" data-v-fda27140>更新时间:</span> 2024-04-01 11:28:35</div></div> <div class="theme-default-content content__default"><h2 id="spark是什么"><a href="#spark是什么" class="header-anchor">#</a> Spark是什么</h2> <p>定义：Apache Spark是用于大规模数据(large-scala data) 处理的统一(unified)分析引擎。<br>
简单来说，Spark是一款分布式的计算框架，用于调度成百上千的服务器集群，计算TB、PB乃至EB级别的海量数据。
Spark作为全球顶级的分布式计算框架，支持众多的编程语言进行开发。而Python语言，则是Spark重点支持的方向。</p> <h3 id="pyspark"><a href="#pyspark" class="header-anchor">#</a> PySpark</h3> <p>Spark对Python语言的支持，重点体现在，Python第三方库：PySpark之上。</p> <p>PySpark是由Spark官方开发的Python语言第三方库。<br>
Python开发者可以使用pip程序快速的安装PySpark并像其它第三方库那样直接使用。</p> <h2 id="基础准备"><a href="#基础准备" class="header-anchor">#</a> 基础准备</h2> <h3 id="pyspark库的安装"><a href="#pyspark库的安装" class="header-anchor">#</a> PySpark库的安装</h3> <p>同其它的第三方库一样，PySpark同样可以使用pip程序进行安装。</p> <p>在“CMD”命令提示符程序内，输入：<br>
pip install pyspark<br>
或者使用国内代理镜像网站(清华大学源)<br>
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple pyspark</p> <h3 id="构建pyspark执行环境入口对象"><a href="#构建pyspark执行环境入口对象" class="header-anchor">#</a> 构建PySpark执行环境入口对象</h3> <p>想要使用PySpark库完成数据库处理，首先需要构建一个执行环境入口对象。<br>
PySpark的执行环境入口对象是：类 SparkContext 的类对象。</p> <div class="language-py line-numbers-mode"><pre class="language-py"><code><span class="token comment"># 导包 </span>
<span class="token keyword">from</span> pyspark <span class="token keyword">import</span> SparkConf<span class="token punctuation">,</span> SparkContext

<span class="token comment"># 创建SparkConf对象</span>
conf <span class="token operator">=</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[*]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;test_spark_app&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># 基于SparkConf类对象创建SparkContext类对象</span>
sc <span class="token operator">=</span> SparkContext<span class="token punctuation">(</span>conf<span class="token operator">=</span>conf<span class="token punctuation">)</span>

<span class="token comment"># 打印PySpark的运行版本</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sc<span class="token punctuation">.</span>version<span class="token punctuation">)</span>

<span class="token comment"># 停止SparkContext对象的运行（停止PySpark程序）</span>
sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>第一次运行报错了
<img src="https://daodaoblogpicgo.oss-cn-shanghai.aliyuncs.com/img/202404011326604.png" alt=""></p> <p>原因是我没有安装java的jdk:</p> <ol><li>安装Java：如果未安装，请前往Oracle官网下载并安装Java，我装的17。</li> <li>设置JAVA_HOME环境变量：打开“系统属性”，选择“高级”选项卡，点击“环境变量”。在系统变量中点击“新建”，变量名输入JAVA_HOME，变量值输入Java安装目录的路径,不用带bin。</li> <li>在path中添加 %JAVA_HOME%\bin</li> <li><img src="https://daodaoblogpicgo.oss-cn-shanghai.aliyuncs.com/img/202404011347486.png" alt=""></li> <li>然后配置JAVA_HOME
<img src="https://daodaoblogpicgo.oss-cn-shanghai.aliyuncs.com/img/202404011348290.png" alt=""></li></ol> <p>再次运行就不报错了。</p></div> <h3 id="pyspark的编程模型"><a href="#pyspark的编程模型" class="header-anchor">#</a> PySpark的编程模型</h3> <p>SparkContext类对象，是PySpark编程中一切功能的入口。<br>
PySpark的编程，主要分为如下三大步骤：</p> <ul><li><p>数据输入<br>
通过SparkContext类对象的成员方法，完成数据的读取操作，读取后得到RDD类对象。</p></li> <li><p>数据处理计算<br>
通过RDD类对象的成员方法，完成各种数据计算的需求。</p></li> <li><p>数据输出<br>
将处理完成后的RDD对象，调用各种成员方法完成，写出文件、转换为list等操作。</p></li></ul> <h2 id="数据输入"><a href="#数据输入" class="header-anchor">#</a> 数据输入</h2> <h3 id="rdd对象"><a href="#rdd对象" class="header-anchor">#</a> RDD对象</h3> <p>PySpark支持多种数据的输入，在输入完成后，都会得到一个：RDD类的对象。<br>
RDD全程为：弹性分布式数据集（Resilient Distributed Datasets）<br>
PySpark针对数据的处理，都是以RDD对象作为载体，即：</p> <ul><li>数据存储在RDD内</li> <li>各类数据的计算方法，也都是RDD的成员方法</li> <li>RDD的数据计算方法，返回值依旧是RDD对象</li></ul> <h3 id="python数据容器转rdd对象"><a href="#python数据容器转rdd对象" class="header-anchor">#</a> Python数据容器转RDD对象</h3> <p>PySpark支持通过SparkContext对象的parallelize成员方法，将：</p> <ul><li>list</li> <li>tuple</li> <li>set</li> <li>dict</li> <li>str<br>
转换为PySpark的RDD对象</li></ul> <div class="custom-block warning"><p class="custom-block-title">注意</p> <ul><li>字符串会被拆分出1个个的字符，存入RDD对象</li> <li>字典仅有key会被存入RDD对象</li></ul></div> <div class="language-py line-numbers-mode"><pre class="language-py"><code><span class="token keyword">from</span> pyspark <span class="token keyword">import</span> SparkConf<span class="token punctuation">,</span> SparkContext

conf <span class="token operator">=</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[*]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;test_spark_app&quot;</span><span class="token punctuation">)</span>

sc <span class="token operator">=</span> SparkContext<span class="token punctuation">(</span>conf<span class="token operator">=</span>conf<span class="token punctuation">)</span>

<span class="token comment"># 通过parallelize方法将Python对象加载到Spark内，成为RDD对象</span>
rdd1 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
rdd2 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
rdd3 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token string">&quot;abcdefg&quot;</span><span class="token punctuation">)</span>
rdd4 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
rdd5 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;key1&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;value1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;key2&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;value2&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 如果要查看RDD里面有什么内容，需要用collect()方法</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>rdd1<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># [1, 2, 3, 4, 5]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>rdd2<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># [1, 2, 3, 4, 5]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>rdd3<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># ['a', 'b', 'c', 'd', 'e', 'f', 'g']</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>rdd4<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># [1, 2, 3, 4, 5]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>rdd5<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># ['key1', 'key2']</span>

sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="读取文件转rdd对象"><a href="#读取文件转rdd对象" class="header-anchor">#</a> 读取文件转RDD对象</h3> <p>PySpark也支持通过SparkContext入口对象，来读取文件，来构建出RDD对象。</p> <div class="language-py line-numbers-mode"><pre class="language-py"><code><span class="token keyword">from</span> pyspark <span class="token keyword">import</span> SparkConf<span class="token punctuation">,</span> SparkContext

conf <span class="token operator">=</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[*]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;test_spark_app&quot;</span><span class="token punctuation">)</span>

sc <span class="token operator">=</span> SparkContext<span class="token punctuation">(</span>conf<span class="token operator">=</span>conf<span class="token punctuation">)</span>

<span class="token comment"># 用textFile方法，读取文件数据加载到Spark内，成为RDD对象</span>
rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">&quot;./hello.txt&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>rdd<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># ['itheima', 'nihao', 'daodao', 'youyou', 'haha']</span>

sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="数据计算"><a href="#数据计算" class="header-anchor">#</a> 数据计算</h2> <h3 id="map方法"><a href="#map方法" class="header-anchor">#</a> map方法</h3> <p>PySpark的数据计算，都是基于RDD对象来进行的，那么如何进行呢？<br>
自然是依赖RDD对象内置丰富的：成员方法（算子）</p> <h4 id="map算子"><a href="#map算子" class="header-anchor">#</a> map算子</h4> <p>功能：map算子，是将RDD的数据，一条条处理（处理的逻辑基于map算子中接收的处理函数），返回新的RDD<br>
语法：</p> <div class="language-py line-numbers-mode"><pre class="language-py"><code>rdd<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>
<span class="token comment"># func: f:(T) -&gt; U</span>
<span class="token comment"># f: 表示这是一个函数（方法）</span>
<span class="token comment"># （T) -&gt; U 表示的是方法的定义：</span>
<span class="token comment">#    （）表示传入参数，(T)表示传入1个参数，()表示没有传入参数</span>
<span class="token comment"># T是泛型的代称，在这里表示 任意类型 </span>
<span class="token comment"># U也是泛型的代称，在这里表示 任意类型</span>
<span class="token comment"># -&gt; U 表示返回值</span>
<span class="token comment"># (T) -&gt; U 总结起来的意思是：这是一个方法，这个方法接受一个参数传入，传入参数类型不限，返回一个返回值，返回值类型不限</span>
<span class="token comment"># (A) -&gt; A 总结起来的意思是：这事一个方法，这个方法接受一个参数传入，传入参数类型不限，返回一个返回值，返回值和传入参数类型一致。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-py line-numbers-mode"><pre class="language-py"><code><span class="token keyword">from</span> pyspark <span class="token keyword">import</span> SparkConf<span class="token punctuation">,</span> SparkContext
<span class="token comment"># 这样设置才不会报错，spark才能找到python解释权的位置</span>
<span class="token keyword">import</span> os
os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'PYSPARK_PYTHON'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;D:/python/python3.10.0/python.exe&quot;</span>

conf <span class="token operator">=</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[*]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;test_spark_app&quot;</span><span class="token punctuation">)</span>

sc <span class="token operator">=</span> SparkContext<span class="token punctuation">(</span>conf<span class="token operator">=</span>conf<span class="token punctuation">)</span>

<span class="token comment"># 准备一个RDD</span>
rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 通过map方法将全部数据都乘以10</span>
<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> data <span class="token operator">*</span> <span class="token number">10</span>


rdd2 <span class="token operator">=</span> rdd<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>


<span class="token keyword">print</span><span class="token punctuation">(</span>rdd2<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>rdd<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># [10, 20, 30, 40, 50]</span>
<span class="token comment"># [1, 2, 3, 4, 5]</span>

sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>一开始一直报错，后来把python版本改成了3.10.0就可以了</p></div> <h4 id="链式调用"><a href="#链式调用" class="header-anchor">#</a> 链式调用</h4> <p>对于返回值是新RDD的算子，可以通过链式调用的方式多次调用算子</p> <h3 id="flatmap算子"><a href="#flatmap算子" class="header-anchor">#</a> flatMap算子</h3> <p>功能：对rdd执行map操作，然后进行解除嵌套操作<br>
解除嵌套：</p> <div class="language-py line-numbers-mode"><pre class="language-py"><code><span class="token comment"># 嵌套的list</span>
lst <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token comment"># 如果解除了嵌套</span>
lst <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>演示代码：</p> <div class="language-py line-numbers-mode"><pre class="language-py"><code><span class="token comment"># coding:utf8</span>
<span class="token comment"># 演示rdd的flatMap算子</span>
<span class="token keyword">from</span> pyspark <span class="token keyword">import</span> SparkConf<span class="token punctuation">,</span> SparkContext

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token comment"># 0. 构建Spark执行环境</span>
    conf <span class="token operator">=</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;create rdd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[*]&quot;</span><span class="token punctuation">)</span>
    sc <span class="token operator">=</span> SparkContext<span class="token punctuation">(</span>conf <span class="token operator">=</span> conf<span class="token punctuation">)</span>

    rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;a b c&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;a c e&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;e c a&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># 按照空格切分数据后，解除嵌套</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>rdd<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="reducebykey算子"><a href="#reducebykey算子" class="header-anchor">#</a> reduceByKey算子</h3> <p>功能： 针对KV型RDD（二元元组），自动按照key分组，然后根据你提供的聚合逻辑，完成组内数据（value）的聚合操作。<br>
用法：</p> <div class="language-py line-numbers-mode"><pre class="language-py"><code>rdd<span class="token punctuation">.</span>reduceByKey<span class="token punctuation">(</span>func<span class="token punctuation">)</span>
<span class="token comment"># func:(V, V) -&gt; V</span>
<span class="token comment"># 接受2个传入参数（类型要一致),返回一个返回值，类型和传入要求一致。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>代码：</p> <div class="language-py line-numbers-mode"><pre class="language-py"><code>rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
result <span class="token operator">=</span> rdd<span class="token punctuation">.</span>reduceByKey<span class="token punctuation">(</span><span class="token keyword">lambda</span> a<span class="token punctuation">,</span>b<span class="token punctuation">:</span> a<span class="token operator">+</span>b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># [('b',3),('a',2)]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>reduceByKey中接收的函数，只负责聚合，不理会分组，分组是自动 by key 来分组的
<img src="https://daodaoblogpicgo.oss-cn-shanghai.aliyuncs.com/img/202404020905833.png" alt=""></p></div> <h3 id="filter"><a href="#filter" class="header-anchor">#</a> Filter</h3> <p>功能：过滤想要的数据进行保留<br>
语法：</p> <div class="language-py line-numbers-mode"><pre class="language-py"><code>rdd<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>
<span class="token comment"># func:(T) -&gt; bool 传入1个参数进来随意类型，返回值必须是True or False</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">注意</p> <p>返回值是True的数据被保留，False的数据被丢弃</p></div> <p>示例代码：</p> <div class="language-py line-numbers-mode"><pre class="language-py"><code><span class="token comment"># coding:utf8</span>
<span class="token comment"># 演示rdd的filter算子</span>
<span class="token keyword">from</span> pyspark <span class="token keyword">import</span> SparkConf<span class="token punctuation">,</span> SparkContext

conf <span class="token operator">=</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;create rdd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[*]&quot;</span><span class="token punctuation">)</span>
sc <span class="token operator">=</span> SparkContext<span class="token punctuation">(</span>conf <span class="token operator">=</span> conf<span class="token punctuation">)</span>

rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 保留奇数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>rdd<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token comment"># [2, 4]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="distinct算子"><a href="#distinct算子" class="header-anchor">#</a> distinct算子</h3> <p>功能：对RDD数据进行去重，返回新RDD<br>
语法： rdd.distinct() 无需传参</p> <p>演示代码：</p> <div class="language-py line-numbers-mode"><pre class="language-py"><code><span class="token comment"># coding:utf8</span>
<span class="token comment"># 演示rdd的distinct算子</span>
<span class="token keyword">from</span> pyspark <span class="token keyword">import</span> SparkConf<span class="token punctuation">,</span> SparkContext

conf <span class="token operator">=</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;create rdd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[*]&quot;</span><span class="token punctuation">)</span>
sc <span class="token operator">=</span> SparkContext<span class="token punctuation">(</span>conf <span class="token operator">=</span> conf<span class="token punctuation">)</span>

rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>rdd<span class="token punctuation">.</span>distinct<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># [1, 9, 3, 4, 6]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="sortby算子"><a href="#sortby算子" class="header-anchor">#</a> sortBy算子</h3> <p>功能：对RDD数据进行排序，基于指定的排序依据<br>
语法：</p> <div class="language-py line-numbers-mode"><pre class="language-py"><code>rdd<span class="token punctuation">.</span>sortBy<span class="token punctuation">(</span>func<span class="token punctuation">,</span> ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> numPartitions<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># func:(T) -&gt; U: 告知按照rdd中的哪个数据进行排序，比如 lambda x: x[1] 表示按照rdd中的第二列元素进行排序</span>
<span class="token comment"># ascending True升序， False降序</span>
<span class="token comment"># numPartitions: 用多少分区排序 </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-py line-numbers-mode"><pre class="language-py"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;
完成练习案例：单词计数统计
&quot;&quot;&quot;</span>
<span class="token comment"># 1.构建执行环境入口对象</span>
<span class="token keyword">from</span> pyspark <span class="token keyword">import</span> SparkConf<span class="token punctuation">,</span>SparkContext
<span class="token keyword">import</span> os
os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'PYSPARK_PYTHON'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;D:/python/python3.10.0/python.exe&quot;</span>

conf <span class="token operator">=</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[*]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;count_app&quot;</span><span class="token punctuation">)</span>
sc <span class="token operator">=</span> SparkContext<span class="token punctuation">(</span>conf<span class="token operator">=</span>conf<span class="token punctuation">)</span>

<span class="token comment"># 2.读取数据文件</span>
rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">&quot;./hello.txt&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># 3.取出全部单词</span>
rdd1 <span class="token operator">=</span> rdd<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 4.将所有单词都转换成二元元组，单词为key,value设置为1</span>
rdd2 <span class="token operator">=</span> rdd1<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 5.分组并求和</span>
rdd3 <span class="token operator">=</span> rdd2<span class="token punctuation">.</span>reduceByKey<span class="token punctuation">(</span><span class="token keyword">lambda</span> a<span class="token punctuation">,</span> b<span class="token punctuation">:</span> a <span class="token operator">+</span> b<span class="token punctuation">)</span>

<span class="token comment"># 6.对结果进行排序</span>
result <span class="token operator">=</span> rdd3<span class="token punctuation">.</span>sortBy<span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> numPartitions<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># 7.打印并输出结果</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># [('itheima', 8), ('python', 6), ('spark', 4), ('itcast', 3), ('pyspark', 3)]</span>

sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h2 id="数据输出"><a href="#数据输出" class="header-anchor">#</a> 数据输出</h2> <ul><li><p>数据输入：</p> <ul><li>sc.parallelize</li> <li>sc.textFile</li></ul></li> <li><p>数据计算： 返回值还是rdd的方法</p> <ul><li>rdd.map</li> <li>rdd.flatMap</li> <li>rdd.reduceByKey</li> <li>rdd.filter</li> <li>rdd.distinct</li> <li>rdd.sortBy</li></ul></li> <li><p>数据输出： 输出Python对象或文件，返回值不是rdd的方法</p> <ul><li>collect</li> <li>reduce</li> <li>take</li> <li>count</li></ul></li></ul> <h3 id="collect算子"><a href="#collect算子" class="header-anchor">#</a> collect算子</h3> <p>功能：将RDD各个分区的数据，统一收集到Driver中，形成一个List对象<br>
用法： rdd.collect()  返回值是一个list</p> <h3 id="reduce算子"><a href="#reduce算子" class="header-anchor">#</a> reduce算子</h3> <p>功能：对RDD数据集按照你传入的逻辑进行聚合<br>
语法：</p> <div class="language-py line-numbers-mode"><pre class="language-py"><code>rdd<span class="token punctuation">.</span><span class="token builtin">reduce</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>
<span class="token comment"># func: (T, T) -&gt; T</span>
<span class="token comment"># 2参数传入，1个返回值，返回值和参数要求类型一致</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>执行流程图：
<img src="https://daodaoblogpicgo.oss-cn-shanghai.aliyuncs.com/img/202404021154601.png" alt=""></p> <p>代码：</p> <div class="language-py line-numbers-mode"><pre class="language-py"><code>rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 将rdd的数据进行累加求和</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>rdd<span class="token punctuation">.</span><span class="token builtin">reduce</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> a<span class="token punctuation">,</span>b<span class="token punctuation">:</span> a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="take算子"><a href="#take算子" class="header-anchor">#</a> take算子</h3> <p>功能：取RDD的前N个元素，组合成list返回给你</p> <div class="language-py line-numbers-mode"><pre class="language-py"><code>sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>take<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
 <span class="token comment"># [3,2,1,4,5]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="count算子"><a href="#count算子" class="header-anchor">#</a> count算子</h3> <p>功能：计算RDD有多少条数据，返回值是一个数字</p> <div class="language-py line-numbers-mode"><pre class="language-py"><code>sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 6</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="saveastextfile算子"><a href="#saveastextfile算子" class="header-anchor">#</a> saveAsTextFile算子</h3> <p>功能：将RDD的数据写入文本文件中</p> <ul><li>输出的结果是一个文件夹</li> <li>有几个分区就输出多少个结果文件<br>
支持本地写出，hdfs等文件系统</li></ul> <div class="language-py line-numbers-mode"><pre class="language-py"><code><span class="token keyword">from</span> pyspark <span class="token keyword">import</span> SparkConf<span class="token punctuation">,</span>SparkContext
<span class="token keyword">import</span> os
os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'PYSPARK_PYTHON'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;D:/python/python3.10.0/python.exe&quot;</span>

conf <span class="token operator">=</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[*]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;count_app&quot;</span><span class="token punctuation">)</span>
sc <span class="token operator">=</span> SparkContext<span class="token punctuation">(</span>conf<span class="token operator">=</span>conf<span class="token punctuation">)</span>

<span class="token comment"># 准备RDD1</span>
rdd1 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 准备RDD2</span>
rdd2 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&quot;Spark&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&quot;Hi&quot;</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 准备RDD3</span>
rdd3 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 输出到文件中</span>
rdd1<span class="token punctuation">.</span>saveAsTextFile<span class="token punctuation">(</span><span class="token string">&quot;./output1&quot;</span><span class="token punctuation">)</span>
rdd2<span class="token punctuation">.</span>saveAsTextFile<span class="token punctuation">(</span><span class="token string">&quot;./output2&quot;</span><span class="token punctuation">)</span>
rdd3<span class="token punctuation">.</span>saveAsTextFile<span class="token punctuation">(</span><span class="token string">&quot;./output3&quot;</span><span class="token punctuation">)</span>

sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">注意事项</p> <p>调用保存文件的算子，需要配置Hadoop依赖</p> <ul><li>下载Hadoop安装包
<ul><li><a href="http://archive.apache.org/dist/hadoop/common/hadoop-3.0.0/hadoop-3.0.0.tar.gz" target="_blank" rel="noopener noreferrer">http://archive.apache.org/dist/hadoop/common/hadoop-3.0.0/hadoop-3.0.0.tar.gz<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li>解压到电脑任意位置</li> <li>在Python代码中使用os模块配置：os.environ['HADOOP_HOME'] = 'HADOOP解压文件夹路径'</li> <li>下载winutils.exe,并放入Hadoop解压文件夹的bin目录内
<ul><li><a href="https://raw.githubusercontent.com/steveloughran/winutils/master/hadoop-3.0.0/bin/winutils.exe" target="_blank" rel="noopener noreferrer">https://raw.githubusercontent.com/steveloughran/winutils/master/hadoop-3.0.0/bin/winutils.exe<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li>下载hadoop.dll,并放入 C:/Windows/System32 文件夹内
<ul><li><a href="https://raw.githubusercontent.com/steveloughran/winutils/master/hadoop-3.0.0/bin/hadoop.dll" target="_blank" rel="noopener noreferrer">https://raw.githubusercontent.com/steveloughran/winutils/master/hadoop-3.0.0/bin/hadoop.dll<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div> <div class="language-py line-numbers-mode"><pre class="language-py"><code><span class="token comment"># 构建执行环境入口对象</span>
<span class="token keyword">from</span> pyspark <span class="token keyword">import</span> SparkConf<span class="token punctuation">,</span>SparkContext
<span class="token keyword">import</span> os
os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'PYSPARK_PYTHON'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;D:/python/python3.10.0/python.exe&quot;</span>
os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'HADOOP_HOME'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;D:/python/hadoop3.0.0&quot;</span>

conf <span class="token operator">=</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[*]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;count_app&quot;</span><span class="token punctuation">)</span>
sc <span class="token operator">=</span> SparkContext<span class="token punctuation">(</span>conf<span class="token operator">=</span>conf<span class="token punctuation">)</span>

<span class="token comment"># 准备RDD1</span>
rdd1 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 准备RDD2</span>
rdd2 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&quot;Spark&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">&quot;Hi&quot;</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 准备RDD3</span>
rdd3 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 输出到文件中</span>
rdd1<span class="token punctuation">.</span>saveAsTextFile<span class="token punctuation">(</span><span class="token string">&quot;./output1&quot;</span><span class="token punctuation">)</span>
rdd2<span class="token punctuation">.</span>saveAsTextFile<span class="token punctuation">(</span><span class="token string">&quot;./output2&quot;</span><span class="token punctuation">)</span>
rdd3<span class="token punctuation">.</span>saveAsTextFile<span class="token punctuation">(</span><span class="token string">&quot;./output3&quot;</span><span class="token punctuation">)</span>

sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><img src="https://daodaoblogpicgo.oss-cn-shanghai.aliyuncs.com/img/202404021400156.png" alt="">
数据被分散到了8个分区中</p> <h3 id="修改rdd分区为1个"><a href="#修改rdd分区为1个" class="header-anchor">#</a> 修改rdd分区为1个</h3> <ul><li>方式1，SparkConf对象设置属性全局并行度为1：</li></ul> <div class="language-py line-numbers-mode"><pre class="language-py"><code>conf <span class="token operator">=</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[*]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;test_spark&quot;</span><span class="token punctuation">)</span>
conf<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">&quot;spark.default.parallelism&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span>
sc <span class="token operator">=</span> SparkContext<span class="token punctuation">(</span>conf <span class="token operator">=</span> conf<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>方式2，创建RDD的时候设置（parallelize方法传入numSlices参数为1）</li></ul> <div class="language-py line-numbers-mode"><pre class="language-py"><code>rdd1 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> numSlices <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
rdd1 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Ostask/daodao-knowledge/edit/master/docs/python/01.python基础/11.PySpark综合案例.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer></div> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/daodao-knowledge/pages/1f7757/" class="prev">
        SQL入门和实战
      </a></span> <span class="next"><a href="/daodao-knowledge/pages/44ca69/">
        Python高阶技巧
      </a>
      →
    </span></p></div>  <div class="footer">
    MIT Licensed | Copyright © 2021-present 刀刀
  </div></main></div><div class="global-ui"></div></div>
    <script src="/daodao-knowledge/assets/js/app.f5ed6583.js" defer></script><script src="/daodao-knowledge/assets/js/8.65e0c7d8.js" defer></script><script src="/daodao-knowledge/assets/js/9.2d64f842.js" defer></script><script src="/daodao-knowledge/assets/js/75.3f2ed8e5.js" defer></script>
  </body>
</html>
