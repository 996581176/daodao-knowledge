---
title: 多任务编程(上)
date: 2024-04-19 16:14:23
permalink: /pages/a74c82/
categories:
  - python
  - Python进阶
tags:
    -
---
## 编辑器vim
vim是一款功能强大的文本编辑器，也是早年Vi编辑器的加强版，它最大的特色就是使用命令进行编辑，完全脱离了鼠标的操作。  

工作模式：  
- 命令模式  
- 编辑模式  
- 末行模式  

::: warning
vim打开文件进入的是命令模式，编辑模式和末行模式之间不能进行切换，都要通过命令模式来完成
:::
![](https://daodaoblogpicgo.oss-cn-shanghai.aliyuncs.com/img/202404221527802.png)

安装命令： sudo apt-get install   
卸载命令:  sudo apt-get remove

## 多任务介绍
::: warning 利用现学知识能够让两个函数或者方法同时执行吗？
不能，因为之前所写的程序都是单任务的，也就是说一个函数或者方法执行完成另外一个函数或者方法才能执行，要想实现这种操作就需要使用多任务，  
多任务的最大好处是充分利用CPU资源，提高程序的执行效率
:::

- 多任务的概念  
多任务是指在同一时间内执行多个任务，例如：现在电脑安装的操作系统都是多任务操作系统，可以同时运行着多个软件。  

### 多任务的执行方式
- 并发  
  在一段时间内交替去执行任务。  

  ::: tip 例如
  对于单核cpu处理多任务，操作系统轮流让各个软件交替执行，假如：软件1执行0.01秒，切换到软件2，软件2执行0.01秒，再切换到软件3，执行0.01秒，这样反复执行下去。表面上看，每个软件都是交替执行的，但是，由于CPU的执行速度实在是太快了，我们感觉就像这些软件都在同时执行一样，这里需要注意单核cpu是并发的执行多任务的
  :::
- 并行  
  对于多核cpu处理多任务，操作系统会给cpu的每个内核安排一个执行的软件，多个内核是真正的一起执行软件。这里需要注意多核cpu是并行的执行多任务，始终有多个软件一起执行。  

## 进程概念
在Python程序中，想要实现多任务可以使用进程来完成，进程是实现多任务的一种方式。  

一个`正在运行`的程序或者软件就是一个进程，它是操作系统进行资源分配的基本单位，也就是说每启动一个进程，操作系统都会给其分配一定的运行资源(内存资源)保证进程的运行。  

比如：显示生活中的公司可以理解成是一个进程，公司提供办公资源(电脑、办公桌椅等)，真正干活的是员工，员工可以理解成线程。 

::: warning
一个程序运行后至少有一个进程，一个进程默认有一个线程，进程里面可以创建多个线程，线程是依附在进程里面的，没有进程就没有线程。  
:::

### 进程的作用
单进程效果图：   
![](https://daodaoblogpicgo.oss-cn-shanghai.aliyuncs.com/img/202404230859207.png)  

多进程效果图：  
![](https://daodaoblogpicgo.oss-cn-shanghai.aliyuncs.com/img/202404230901313.png)

## 多进程使用
1. 导入进程包
```py
# 导入进程包
import multiprocessing
```

2. Process进程类的说明  
Process([group [,target [,name [,args [,kwargs]]]]])  
- group: 指定进程组，目前只能用None  
- target：执行的目标任务名  
- name: 进程名字  
- args: 以元组方式给执行任务传参  
- kwargs: 以字典方式给执行任务传参

Process创建的实例对象的常用方法： 
- start(): 启动子进程实例（创建子进程） 
- join(): 等待子进程执行结束  
- terminate(): 不管任务是否完成，立即终止子进程  

Process创建的实例对象的常用属性：  
name: 当前进程的别名，默认为Process-N,N为从1开始递增的整数 

3. 代码实现
```py {2,22-27}
import time
import multiprocessing

def sing():
    for i in range(5):
        time.sleep(1)
        print("唱歌",i)

def dance():
    for i in range(5):
        time.sleep(1)
        print("跳舞", i)

if __name__ == '__main__':
    # 单进程需要10秒钟完成
    # 最少有一个进程，这个进程中最少有一个线程
    # 多进程需要5秒完成

    # 注意！！
    # 三个进程： 1个主进程， 2个子进程
    # 三个线程： 每个进程里有一个线程

    # 创建子进程
    # Process:
    # target: 指定执行的任务名
    my_dance = multiprocessing.Process(target=dance)
    my_sing = multiprocessing.Process(target=sing)

    # 开启子进程(如果不开启，是不会执行子进程的)
    my_dance.start()
    my_sing.start()

```

## 获取进程编号
获取进程编号的目的是验证主进程和子进程的关系，可以得知子进程是由哪个主进程创建出来的。  
获取进程编号的两种操作：  
- 获取当前进程编号  
  os.getpid() 表示获取当前进程编号  

- 获取当前父进程编号  
  os.getppid() 表示获取当前父进程编号

## 进程执行带有参数的任务
```py
import time
import multiprocessing
import os

def dance(count,a):
    for i in range(count):
        time.sleep(1)
        print("跳舞", a)

if __name__ == '__main__':
    # 带参数的函数
    # ars: 元组！！！（单个元素的元组有逗号,)
    # kwargs: 字典!!!(key值要和函数中的形参完全重名)
    # my_dance = multiprocessing.Process(target=dance, args=(5,2))
    my_dance = multiprocessing.Process(target=dance, kwargs={"count":5, "a":'bbb'})

    # 开启子进程(如果不开启，是不会执行子进程的)
    my_dance.start()

```

## 进程的注意点
### 进程之间不共享全局变量 
```py
import time
import multiprocessing

g_num = []

def my_write():
    global g_num
    for i in range(5):
        g_num.append(i)

def my_read():
    global g_num
    print(g_num)

if __name__ == '__main__':
    my_write_process = multiprocessing.Process(target=my_write)
    my_read_process = multiprocessing.Process(target=my_read)

    my_write_process.start()
    # 保证数据写入完毕
    time.sleep(1)
    my_write_process.start()

    # []
```

![](https://daodaoblogpicgo.oss-cn-shanghai.aliyuncs.com/img/202404231121629.png)

创建子进程会对主进程资源进行拷贝，也就是说子进程是主进程的一个副本，好比是一对双胞胎，之所以进程之间不共享全局变量，是因为操作的不是同一个进程里面的全局变量，只不过不同进程里面的全局变量名字相同而已。

## 守护主进程