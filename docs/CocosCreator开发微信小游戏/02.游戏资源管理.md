---
title: 游戏资源管理
date: 2024-04-26 15:42:53
permalink: /pages/870050/
categories:
  - CocosCreator开发微信小游戏
tags:
    -
---
从本质上说，每个游戏都是由种类繁多，数量庞大的资源构成的，因此，管理包括图片，声音，字体，粒子，地图等多媒体资源是一款游戏引擎的核心功能。  
资源管理的知识主要有几个方面：包括对于资源的组织，运行期对于资源的载入、清理及对于资源的操作以及资源的优化。  

## 图片资源的管理
图片资源又称贴图，是游戏中，尤其是2D游戏中绝大部分对象的渲染源，图片资源一般由软件制作而成并输出称游戏引擎支持的格式，目前支持的格式包括JPG和PNG两种，除了单张图片外，Cocos Creator还支持图集资源的导入和自动图集资源的生成功能。  

### 图片资源的导入
图片资源导入的方式非常简单，就是将图片资源复制到资源管理器所在的目录下，在资源管理器中的对应目录下就可以看到相应的图片资源，在对于的资源管理器中会显示自身图片的缩略图，以方便你找到想选的那个图片，单击三角形按钮就可以打开图片的子资源，也就是说单机开三角形后可以看到同名的SpriteFramem,SpriteFrame是精灵类用来显示图像的对象。  
对于图片集资源来说，可以有多个图片资源在一个资源名下，直接将SpriteFrame或者图像资源从资源管理器中拖拽到场景编辑器，或者属性监视器的对应属性下时，就可以设置节点的图片显示。单击对应的图片资源文件或者SpriteFrame就可以看到对应的属性检查器中可以编辑的属性，但是目前这些属性的编辑暂时无法影响图片资源在游戏中使用时的属性，应该是为未来引擎扩展预留的编辑接口。
![](https://daodaoblogpicgo.oss-cn-shanghai.aliyuncs.com/img/2024042601.gif)  
运行起来是这样的  
![](https://daodaoblogpicgo.oss-cn-shanghai.aliyuncs.com/img/202404261602188.png)

### 图集资源的制作和导入
图集，也称作 Sprite Sheet, 是游戏开发中场景的一种美术资源。图集是通过专门的工具将多张图片合并成一张大图，并通过plist等格式的文件索引的资源。可供Cocos Creator使用的图集资源由plist和png文件组成。下面就是一张图集使用的图片文件：
![](https://daodaoblogpicgo.oss-cn-shanghai.aliyuncs.com/img/202404261616330.png)

::: warning 为什么要使用图集资源
在游戏中使用多张图片合成的图集作为美术资源，有以下优势：  
- 合成图集时会去除每张图片周围的空白区域，加上可以在整体上实施各种优化算法，合成图集后可以大大减少游戏包体和内存占用 
- 多个Sprite如果渲染是来自同一张图集的图片时，这些Sprite可以使用同一个渲染批次来处理，大大减少CPU的运算时间，提高运行效率。

更形象生动的解释可以观看来自CodeAndWeb的教学视频 What is a Sprite Sheet，需要使用VPN打开视频。
:::

## 声音资源的管理
游戏不止是简单的界面和动画，还需要音乐音效配合。在很多经典的游戏中，音乐音效不止是配角，还可以起到控制游戏节奏、向玩家提示游戏场景的作用。例如有些过关游戏中，在进入Boss关时，音乐变化以此来提示玩家本关的不同之处，另外还有一些游戏，就是以音乐节奏来配合出怪的频率节奏等，这样玩家可以完全融入到游戏中。

### WebAudio方式加载音频
再Cocos Creator中加载音频的方式和图片一样，在资源管理器的路径下添加音频文件即可

Web 平台上的音频资源比较特别，因为 Web 标准支持以两种不同的方式加载音频资源，分别是：

Web Audio：提供相对更加现代化的声音控制接口，在引擎内是以一个 audio buffer 的形式缓存的。这种方式的优点是兼容性好，问题比较少。
DOM Audio：通过生成一个标准的 audio 元素来播放音频资源，在引擎内缓存的就是这个 audio 元素。使用标准的 audio 元素播放音频资源时，在某些浏览器上可能会遇到一些兼容性问题，比如 iOS 上的浏览器不支持调整音量大小，所有 volume 相关属性将不会生效。
目前 Cocos Creator 默认以 Web Audio 的方式加载音频资源，但如果检测到当前浏览器不支持加载 Web Audio，则会切换使用 DOM Audio 的方式加载音频。

## 预制体的创建和使用
预制体这个概念是引自Unity引擎的，它是一种可以被重复使用的游戏对象。例如射击游戏中的子弹都来自于同一个子弹模型，当发射子弹时，就创建一个子弹预制体。也就是说，如果创建一个可以重复使用的对象，那么就该用预制体了。

### 什么是预制体
在一般的游戏开发中，并没有预制体这个概念，它曾经是Unity的专用术语，它可以简单解释成“用于创建大量相同的物件而使用的模板”，也就是说它可以被用于创建重复的对象。虽说它是从Unity才有的概念，但是预制体的设计思想类似设计模式中的原型模式，是用于创建重复的对象，同时又能保证性能。这种类型的设计模式属于创建型模式，它提供了一种创建对象的最佳方式。当直接创建对象的代价比较大时，则采用这种模式。Cocos Creator中的预制体的用法和Unity类似，当制作好了游戏组件，也就是场景中的任意一个对象时，我们可以将它制作成一个组件模板，用于批量的套用工作。例如，场景中本质上要重复使用的东西，像敌人、士兵、子弹或者一个砖块完全相同的墙体。

### 创建预制体
- 在场景中将节点编辑好之后，直接将节点从 层级管理器 拖到 资源管理器 中即可完成预制件资源的创建。

- 点击 资源管理器 左上方的 + 按钮，或者点击面板空白处，然后选择 Node Prefab 即可。（v3.1.1 新增）

## 字体资源的管理
在游戏中，文字占有很重要的位置，尤其对于现在卡牌游戏盛行的市场，界面开发占游戏开发很大的篇幅，其中游戏的介绍，游戏中的提示和对话等都需要用到文字，Cocos Creator在文字渲染方面提供了非常灵活的机制，既可以直接使用系统字，也可以自渲染字体。使用Cocos Creator制作游戏可以使用三类字体资源：系统字体，动态字体和位图字体。

### 系统字体
其中系统字体是通过调用游戏运行平台自带的系统字体来渲染文字，不需要用户在项目中添加任何相关资源。要使用系统字体，请使用 Label组件 中的 Use System Font 属性。

### 动态字体
目前 Cocos Creator 支持 TTF 格式的动态字体。只要将扩展名为 TTF 的字体文件拖拽到 资源管理器 中，即可完成字体资源的导入。

## 粒子资源管理
动画粒子系统会发射大量细小的例子并且非常高效地渲染这些粒子，比渲染单个精灵要高效得多，它可以模拟随机的，栩栩如生的烟雾、闪电、风雨、雪花掉落的效果。

1. 包含大量物理微粒对象  
2. 宏观特性：每个粒子都符合主要的物理规律  
3. 微观特性： 在符合规律的基础上，每个粒子都有自己的随机性和独特性  
4. 过程动态特性： 每个粒子都是动态的，在移动中不断变化，在每个模拟中都是不断自己更新自己的  

### Cocos Creator中的粒子资源
- 粒子系统可通过[particle desinger](https://www.71squared.com/particledesigner)软件进行制作，也可以通过网页在线制作[http://www.effecthub.com/particle2dx#google_vignette](http://www.effecthub.com/particle2dx#google_vignette)  
- 导入粒子资源到资源管理器  
- 从资源管理器里将粒子资源直接拖到层级管理器或者场景编辑器，就可以直接使用

## Tiled地图集资源管理
在很多游戏中，整个游戏场景中除了主角精灵之外，游戏的地图北京也是一块“重头戏”。在手机游戏的开发中，为了节约内存空间，一般使用图素拼接的方法组成整个地图。也就是说，首先定下图素块（一般为正方形）的大小，然后美术绘制图素块，最后由策划和美术根据不同项目的需求使用地图编辑器将图素拼接成大地图，并将生成的数据文件和图素交给程序处理。 

### Tiled地图编辑器
Cocos Creator支持Tiled地图编辑器生成的地图数据文件，Tiled地图编辑器的下载地址为[https://www.mapeditor.org/](https://www.mapeditor.org/)  
Tiled地图编辑器是一个以普遍使用为目标的地图编辑器，它容易使用并且容易再不同的引擎中使用，目前它的最新版本是使用Qt框架进行开发的。  

Tiled地图编辑器的特性如下：  
- 使用多种编码形式的地图数据文件使它可以在不同的游戏引擎中通用  
- 支持普通视角和45度两种视角  
- 可以把对象放在精确到像素的位置  
- 支持撤销/重做和复制/粘贴的操作  
- 图素、层次和对象等通用的概念  
- 自动重新载入图素集  
- 可以重置图素的大小和偏移  
- 支持图章刷和填充等高效工具的使用  
- 支持以通用的格式输入输出来打开和储存文件  

### 安装使用Tiled地图编辑器
- 地图资源文件的导入  
- 地图所需资源有：  
  - .tmx地图数据  
  - .png图集纹理  
  - .tsx tileset 数据配置文件（部分tmx文件需要）  
- 在cocos creator中使用地图资源  
  - 第一种方式： 从资源管理器里将地图资源拖动到层级管理器中  
  - 第二种方式： 从资源管理器里将地图资源拖动到场景中 
  - 第三种方式： 从资源管理器里将地图资源拖动到已创建 TiledMap 组件的 Tmx File属性中  

## 骨骼动画  
Creator 中的骨骼动画资源是由 [Spine 编辑器](https://zh.esotericsoftware.com/) 导出的，目前支持 JSON 和 二进制 两种数据格式。

### 骨骼动画介绍  
- 什么是骨骼动画  

骨骼动画的特点是，需要做动画的物体对象本身不记录位移、旋转、缩放、变形信息，而是通过了第三方的“骨骼”物体记录动画信息，然后物体对象本身只记录收到骨骼物体影响的权重。在播放的时候，通过骨骼物体的关键帧和物体对象记录的权重，让动画重现。 

- 骨骼动画的好处  
相对于传统动画，骨骼动画似乎多了2个记录：骨骼物体和权重。按道理来说，这种骨骼动画的资源容量和运行效率应该不如传统的动画，那为什么还要做骨骼动画呢？  

好处有以下几点：  
1. 骨骼动画是影响到顶点级别的动画，而且可以多根各个根据权重影响同一个顶点，不论是2D或者3D使用，都可以让动画做得更丰富。  
2. 做到了对象和动画分离，我们只需要记录了物体对于骨骼的蒙皮权重，就可以单独的去制作骨骼的动画，在保证蒙皮信息和骨骼信息一致的情况下，还可以多个物体之间共享动画。  
3. 相对于2D的逐帧动画大大节省资源容量  

### 导入骨骼动画资源
骨骼动画所需资源有：  
- .json/.skel 骨骼数据
- .png 图集纹理  
- .txt/.atlas 图集数据 