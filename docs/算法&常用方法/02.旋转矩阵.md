---
title: 旋转矩阵
date: 2024-04-15 09:24:47
permalink: /pages/777e9c/
categories:
  - 算法&常用方法
tags:
    -
---
## 前言
公司有个需求需要计算图片旋转任意角度后的包围框坐标，这就需要用到旋转矩阵，虽然百度可以很容易的搜索到，但是我这个人喜欢刨根问底然后举一反三，不懂原理心里就痒痒。所以就从矩阵开始学起。

## 矩阵的数学定义
矩阵在3D数学中具有根本意义上的重要性，它们主要用于描述两个坐标空间之间的关系。它们通过定义矢量从一个坐标空间转换为另一个坐标空间来实现目的。  
在线性代数中，矩阵是排列成行和列的矩形数字网格。
### 矩阵维度和表示法
对于具有r行和c列的矩阵，称为是r×c（读作r乘c）矩阵。例如，一下一个4 × 3矩阵有4行3列：
<div class="rect">
    <div class="row">
        <span>4</span>
        <span>0</span>
        <span>12</span>
    </div>
    <div class="row">
        <span>-5</span>
        <span>√4</span>
        <span>3</span>
    </div>
    <div class="row">
        <span>12</span>
        <span>-4/3</span>
        <span>-1</span>
    </div>
    <div class="row">
        <span>1/2</span>
        <span>18</span>
        <span>0</span>
    </div>
</div>

当希望引用矩阵中的各个元素时，将使用下标表示法，通常用相应的小写斜体字母。例如，一下就是一个3×3矩阵：
<div class="rect">
    <div class="row">
        <span>m<sub>11</sub></span>
        <span>m<sub>12</sub></span>
        <span>m<sub>13</sub></span>
    </div>
    <div class="row">
        <span>m<sub>21</sub></span>
        <span>m<sub>22</sub></span>
        <span>m<sub>23</sub></span>
    </div>
    <div class="row">
        <span>m<sub>31</sub></span>
        <span>m<sub>32</sub></span>
        <span>m<sub>33</sub></span>
    </div>
</div>

符号mij表示矩阵M的行i列j中的元素

### 方形矩阵
具有相同行数和列数的矩阵称为方形矩阵（Square Matrice），并且它是特别重要的内容。

方形矩阵的对角元素（Diagonal Elements）是行和列索引相同的元素。例如，3×3矩阵M的对角元素是m<sub>11</sub>、m<sub>22</sub>和m<sub>33</sub>。

如果矩阵中的所有非对角元素都为0，则该矩阵为对角矩阵（Diagonal Matrix）。以下4×4矩阵就是一个对角矩阵：

<div class="rect">
    <div class="row">
        <span>3</span>
        <span>0</span>
        <span>0</span>
        <span>0</span>
    </div>
    <div class="row">
        <span>0</span>
        <span>1</span>
        <span>0</span>
        <span>0</span>
    </div>
    <div class="row">
        <span>0</span>
        <span>0</span>
        <span>-5</span>
        <span>0</span>
    </div>
    <div class="row">
        <span>0</span>
        <span>0</span>
        <span>0</span>
        <span>2</span>
    </div>
</div>

有一类特殊的对角矩阵是单位矩阵（Identity Matrix）。维度为n的单位矩阵，表示为In,是n×n矩阵，其对角线上的值为1，其他元素均为0。例如，以下是一个3×3单位矩阵：
<div class="rect">
    <div class="row">
        <span>1</span>
        <span>0</span>
        <span>0</span>
    </div>
    <div class="row">
        <span>0</span>
        <span>1</span>
        <span>0</span>
    </div>
    <div class="row">
        <span>0</span>
        <span>0</span>
        <span>1</span>
    </div>
</div>

### 作为矩阵的矢量
矩阵可以包含任何正数的行和列，包括一个。

维数n的矢量可以被视为 1×n 矩阵，或者被视为n×1矩阵。

1×n矩阵称为行矢量，n×1矩阵称为列矢量。行矢量以横向方式书写，列矢量则以纵向方式书写：

<div class="rect">
    <div class="row">
        <span>1</span>
        <span>2</span>
        <span>3</span>
    </div>
</div>
<div class="rect">
    <div class="row">
        <span>1</span>
    </div>
    <div class="row">
        <span>2</span>
    </div>
    <div class="row">
        <span>3</span>
    </div>
</div>


::: warning
当使用带有矩阵的矢量时，必须非常清楚该矢量是行矢量还是列矢量。
:::

### 矩阵转置
给定 r × c矩阵M，M的转置表示为M<sup>T</sup>,是c×r矩阵，其中，列由M的行构成。这实际上是以对角方式翻转矩阵。
<div class="rect" style="vertical-align:middle;">
    <div class="row">
        <span>1</span>
        <span>2</span>
        <span>3</span>
    </div>
    <div class="row">
        <span>4</span>
        <span>5</span>
        <span>6</span>
    </div>
    <div class="row">
        <span>7</span>
        <span>8</span>
        <span>9</span>
    </div>
    <div class="row">
        <span>10</span>
        <span>11</span>
        <span>12</span>
    </div>
</div>
<sub style="vertical-align:top;">T</sub>
<span style="vertical-align:middle;"> = </span>
<div class="rect" style="vertical-align:middle;">
    <div class="row">
        <span>1</span>
        <span>4</span>
        <span>7</span>
        <span>10</span>
    </div>
    <div class="row">
        <span>2</span>
        <span>5</span>
        <span>8</span>
        <span>11</span>
    </div>
    <div class="row">
        <span>3</span>
        <span>6</span>
        <span>9</span>
        <span>12</span>
    </div>
</div>

对于矢量，转置会将行矢量转换为列矢量

<div class="rect" style="vertical-align:middle;">
    <div class="row">
        <span>x</span>
        <span>y</span>
        <span>z</span>
    </div>
</div>
<sub style="vertical-align:top;">T</sub>
<span style="vertical-align:middle;"> = </span>
<div class="rect" style="vertical-align:middle;">
    <div class="row">
        <span>x</span>
    </div>
    <div class="row">
        <span>y</span>
    </div>
    <div class="row">
        <span>z</span>
    </div>
</div>    

反之亦然。  

<div class="rect" style="vertical-align:middle;">
    <div class="row">
        <span>x</span>
    </div>
    <div class="row">
        <span>y</span>
    </div>
    <div class="row">
        <span>z</span>
    </div>
</div>
<sub style="vertical-align:top;">T</sub>
<span style="vertical-align:middle;"> = </span>

<div class="rect" style="vertical-align:middle;">
    <div class="row">
        <span>x</span>
        <span>y</span>
        <span>z</span>
    </div>
</div>

::: warning
- 对于任何维度的矩阵M，（M<sup>T</sup>）<sup>T</sup> = M。换句话说，如果先转置矩阵，然后再转置一次，即可得到原始矩阵。此规则也适用于矢量。  
- 任何对角矩阵D等于其转置：D<sup>T</sup> = D。包括单位矩阵I也是如此
:::

### 矩阵与标量相乘
矩阵M可以与标量k相乘，得到与M相同维度的矩阵。我们通过将标量和矩阵并排放置（通常标量在左边）来表示标量与矩阵的乘法。`中间不需要乘法符号`。  
结果矩阵kM中的每个元素是k与M中相应元素的乘积。  

<div>
    <span class="middle">kM=k</span>
    <div class="rect middle">
        <div class="row">
            <span>m<sub>11</sub></span>
            <span>m<sub>12</sub></span>
            <span>m<sub>13</sub></span>
        </div>
        <div class="row">
            <span>m<sub>21</sub></span>
            <span>m<sub>22</sub></span>
            <span>m<sub>23</sub></span>
        </div>
        <div class="row">
            <span>m<sub>31</sub></span>
            <span>m<sub>32</sub></span>
            <span>m<sub>33</sub></span>
        </div>
        <div class="row">
            <span>m<sub>41</sub></span>
            <span>m<sub>42</sub></span>
            <span>m<sub>43</sub></span>
        </div>
    </div>
    <span class="middle">=</span>
    <div class="rect middle">
        <div class="row">
            <span>km<sub>11</sub></span>
            <span>km<sub>12</sub></span>
            <span>km<sub>13</sub></span>
        </div>
        <div class="row">
            <span>km<sub>21</sub></span>
            <span>km<sub>22</sub></span>
            <span>km<sub>23</sub></span>
        </div>
        <div class="row">
            <span>km<sub>31</sub></span>
            <span>km<sub>32</sub></span>
            <span>km<sub>33</sub></span>
        </div>
        <div class="row">
            <span>km<sub>41</sub></span>
            <span>km<sub>42</sub></span>
            <span>km<sub>43</sub></span>
        </div>
    </div>
</div>

### 两个矩阵相乘
某些情况下，可以采用两个矩阵的乘积。当允许矩阵乘法时，其结果的计算规则乍看之下可能有点奇怪。

一个r×n矩阵A可以乘以一个n×c矩阵B。其结果（以AB表示）是一个r×c矩阵。

例如：A是一个4×2矩阵，B是一个2×5矩阵，那么AB将是一个4×5矩阵。

::: warning
如果A中的列数与B中的行数不匹配，则乘法结果AB未定义（尽管BA是有可能的）
:::

矩阵乘法计算如下：
设矩阵C为 r×n矩阵A 与 n×c矩阵B的 r×c乘积AB。然后每个元素c<sub>ij</sub>等于A的行i与B的列j的矢量点积，其计算公式为：  
<div>
c<sub>ij</sub> = <div class="sigma">∑<span class="up">n</span><span class="down">k=1</span></div>a<sub>ik</sub>b<sub>kj</sub>
</div>



<style lang="stylus" scoped>
.rect {
    display: inline-block;
    position: relative;
    padding: 0 10px;
    span{
        display: inline-block;
        min-width: 30px;
        text-align:center;
        padding:0 4px;
    }
    &:before {
        content:'';
        top:0;
        left:0;
        position:absolute;
        display:inline-block;
        width: 4px;
        height: 100%;
        border-top:1px solid #000;
        border-bottom: 1px solid #000;
        border-left: 1px solid #000;
    }
    &:after {
        content:'';
        top:0;
        right:0;
        position:absolute;
        display:inline-block;
        width: 4px;
        height: 100%;
        border-top:1px solid #000;
        border-bottom: 1px solid #000;
        border-right: 1px solid #000;
    }
}
.middle {
    vertical-align: middle;
}
.top {
    vertical-align: top;
}
.sigma {
    display:inline-block;
    font-size:20px;
    position:relative;
    padding-right:8px;
    .up {
        position:absolute;
        font-size:12px;   
        top: -12px;
        left: 0;         
    }
    .down {
        position:absolute;
        font-size:12px;   
        bottom: -12px;
        left: 0;         
    }
}
</style>