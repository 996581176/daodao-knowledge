(window.webpackJsonp=window.webpackJsonp||[]).push([[129],{589:function(t,s,a){"use strict";a.r(s);var n=a(47),o=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("在用canvas绘制的图片然后执行toDataURL()的时候，报了个错。"),a("br"),t._v(" "),a("img",{attrs:{src:"https://daodaoblogpicgo.oss-cn-shanghai.aliyuncs.com/img/202404151522823.png",alt:""}}),a("br"),t._v("\nUncaught DOMException: Failed to execute 'toDataURL' on 'HTMLCanvasElement': Tainted canvases may not be exported.\nat img.onload")]),t._v(" "),a("h2",{attrs:{id:"原因"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原因"}},[t._v("#")]),t._v(" 原因")]),t._v(" "),a("p",[t._v("报错的大概意思是，canvas无法执行toDataURL方法：污染的画布无法输出。")]),t._v(" "),a("p",[t._v("原来这是因为CORS策略，我的图片存在跨域问题，虽然可以使用图像，但是绘制到画布上会污染画布，一旦一个画布被污染，就无法提取画布的数据，比如无法使用画布toBolb(),toDataURL()或getImageData()方法，当使用这些方法的时候，会抛出一个安全错误。")]),t._v(" "),a("h2",{attrs:{id:"html-属性-crossorigin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#html-属性-crossorigin"}},[t._v("#")]),t._v(" HTML 属性：crossorigin")]),t._v(" "),a("p",[t._v("crossorigin 属性在 "),a("code",[t._v("<audio>")]),t._v("、"),a("code",[t._v("<img>")]),t._v("、"),a("code",[t._v("<link>")]),t._v("、"),a("code",[t._v("<script>")]),t._v(" 和 "),a("code",[t._v("<video>")]),t._v(" 元素中有效，它们提供对 CORS 的支持，定义该元素如何处理跨源请求，从而实现对该元素获取数据的 CORS 请求的配置。根据元素的不同，该属性可以是一个 CORS 设置属性。")]),t._v(" "),a("p",[t._v("在媒体元素上所使用的 crossorigin 内容属性为 CORS 设置属性。")]),t._v(" "),a("p",[t._v("这些属性是枚举的，并具有以下可能的值：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("anonymous"),a("br"),t._v("\n请求使用了 CORS 标头，且证书标志被设置为 'same-origin'。没有通过 cookies、客户端 SSL 证书或 HTTP 认证交换用户凭据，除非目的地是同一来源。")])]),t._v(" "),a("li",[a("p",[t._v("use-credentials"),a("br"),t._v("\n请求使用了 CORS 标头，且证书标志被设置为 'include'。总是包含用户凭据。")])]),t._v(" "),a("li",[a("p",[t._v('""'),a("br"),t._v('\n将属性名称设置为空值，如 crossorigin 或 crossorigin=""，与设置为 anonymous 的效果一样。')])])]),t._v(" "),a("p",[t._v("不合法的关键字或空字符串会视为 anonymous 关键字。")]),t._v(" "),a("p",[t._v("默认情况下（即未指定该属性时），CORS 根本不会使用。用户代理不会要求对资源进行完全访问的许可，在跨源请求的情况下，将根据相关元素的类型进行某些限制：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("元素")]),t._v(" "),a("th",[t._v("限制")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("img、audio、video")]),t._v(" "),a("td",[t._v("当资源被放置在 "),a("code",[t._v("<canvas>")]),t._v(" 中时，元素会标记为被污染的。")])]),t._v(" "),a("tr",[a("td",[t._v("script")]),t._v(" "),a("td",[t._v("对错误日志 window.onerror 的访问将会被限制。")])]),t._v(" "),a("tr",[a("td",[t._v("link")]),t._v(" "),a("td",[t._v("使用了不合适的 crossorigin 标头的请求可能会被丢弃。")])])])]),t._v(" "),a("h2",{attrs:{id:"解决"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决"}},[t._v("#")]),t._v(" 解决")]),t._v(" "),a("p",[t._v("加上这样一行代码就行了，给图片设置crossOrigin属性。\n"),a("img",{attrs:{src:"https://daodaoblogpicgo.oss-cn-shanghai.aliyuncs.com/img/202404151538564.png",alt:""}})]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("img"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAttribute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"crossOrigin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Anonymous'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])])])}),[],!1,null,null,null);s.default=o.exports}}]);